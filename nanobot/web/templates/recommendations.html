{% extends "base.html" %}
{% block title %}Recommendations - K&amp;P Marketing{% endblock %}
{% block content %}
<h2 class="text-2xl font-bold text-kp-blue mb-6">Outreach Recommendations</h2>

<div class="bg-white rounded-xl shadow-sm p-4 mb-6">
    <div>
        <label class="block text-sm font-medium text-kp-dark mb-1">Status</label>
        <select onchange="window.location='?status='+this.value"
                class="w-full sm:w-48 rounded-lg border border-gray-300 px-3 py-2 text-sm text-kp-dark focus:border-kp-blue focus:ring-1 focus:ring-kp-blue outline-none transition-colors duration-200">
            <option value="" {% if current_status == 'all' %}selected{% endif %}>All</option>
            <option value="pending" {% if current_status == 'pending' %}selected{% endif %}>Pending</option>
            <option value="approved" {% if current_status == 'approved' %}selected{% endif %}>Approved</option>
            <option value="sent" {% if current_status == 'sent' %}selected{% endif %}>Sent</option>
            <option value="rejected" {% if current_status == 'rejected' %}selected{% endif %}>Rejected</option>
        </select>
    </div>
</div>

<div class="bg-white rounded-xl shadow-sm overflow-hidden">
    <table class="w-full text-sm">
        <thead>
            <tr class="bg-kp-light border-b border-gray-100">
                <th class="text-left px-4 py-3 text-kp-blue font-semibold text-xs uppercase tracking-wide">Company</th>
                <th class="text-left px-4 py-3 text-kp-blue font-semibold text-xs uppercase tracking-wide">Service Area</th>
                <th class="text-left px-4 py-3 text-kp-blue font-semibold text-xs uppercase tracking-wide">Consultant</th>
                <th class="text-left px-4 py-3 text-kp-blue font-semibold text-xs uppercase tracking-wide">Channel</th>
                <th class="text-left px-4 py-3 text-kp-blue font-semibold text-xs uppercase tracking-wide">Status</th>
                <th class="text-left px-4 py-3 text-kp-blue font-semibold text-xs uppercase tracking-wide">Tracking</th>
                <th class="text-left px-4 py-3 text-kp-blue font-semibold text-xs uppercase tracking-wide">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for rec in recommendations %}
            <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200">
                <td class="px-4 py-3 font-semibold text-kp-dark">{{ rec.company_name }}</td>
                <td class="px-4 py-3 text-kp-text">{{ rec.service_area }}</td>
                <td class="px-4 py-3 text-kp-text">{{ rec.consultant_name or "Unassigned" }}</td>
                <td class="px-4 py-3 text-kp-text">{{ rec.outreach_channel }}</td>
                <td class="px-4 py-3 text-kp-text">{{ rec.status }}</td>
                <td class="px-4 py-3">
                    {% if rec.tracking %}
                    <span class="tier-{{ rec.tracking.heat_status }}">{{ rec.tracking.heat_status }}</span>
                    <br><span class="text-xs text-kp-text">{{ rec.tracking.response_status }}</span>
                    {% endif %}
                </td>
                <td class="px-4 py-3">
                    <div class="flex items-center gap-2 flex-wrap">
                        {% if rec.status == 'pending' %}
                        <form method="post" action="/recommendations/{{ rec.id }}/approve" class="inline">
                            <button type="submit" class="text-sm px-3 py-1 rounded-lg border border-kp-blue text-kp-blue hover:bg-kp-blue hover:text-white transition-colors duration-200">Approve</button>
                        </form>
                        <form method="post" action="/recommendations/{{ rec.id }}/reject" class="inline">
                            <button type="submit" class="text-sm px-3 py-1 rounded-lg border border-gray-300 text-kp-text hover:bg-gray-100 transition-colors duration-200">Reject</button>
                        </form>
                        {% elif rec.status == 'approved' %}
                        <a href="/recommendations/{{ rec.id }}/compose" class="inline-block text-sm px-3 py-1 rounded-lg bg-kp-blue text-white hover:bg-[#004a7e] transition-colors duration-200">Compose Email</a>
                        <form method="post" action="/recommendations/{{ rec.id }}/back-to-pending" class="inline">
                            <button type="submit" class="text-sm px-3 py-1 rounded-lg border border-gray-300 text-kp-text hover:bg-gray-100 transition-colors duration-200">Back to Pending</button>
                        </form>
                        {% elif rec.status == 'sent' %}
                        <form method="post" action="/recommendations/{{ rec.id }}/response-received" class="inline">
                            <button type="submit" class="text-sm px-3 py-1 rounded-lg border border-kp-blue text-kp-blue hover:bg-kp-blue hover:text-white transition-colors duration-200">Response Received</button>
                        </form>
                        <form method="post" action="/recommendations/{{ rec.id }}/no-response" class="inline">
                            <button type="submit" class="text-sm px-3 py-1 rounded-lg border border-gray-300 text-kp-text hover:bg-gray-100 transition-colors duration-200">No Response</button>
                        </form>
                        {% endif %}
                        <button class="text-sm px-3 py-1 rounded-lg border border-kp-blue text-kp-blue hover:bg-kp-blue hover:text-white transition-colors duration-200" onclick="openChat('recommendation', {{ rec.id }})">Discuss</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
            {% if not recommendations %}
            <tr><td colspan="7" class="px-4 py-8 text-center text-kp-text">No recommendations found.</td></tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}
